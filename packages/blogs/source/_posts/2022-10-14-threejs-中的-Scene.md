---
title: threejs 中的 Scene
date: 2022-10-14 18:27:54
tags: [threejs]
categories: Web3D
---

今天阅读了一下 threejs 中 Scene 部分的文档，因此做一个简单的回顾。

要使用 threejs 去渲染一个 3D 的场景，一般而言代码会是如下的结构

```javascript
const renderer = new WebGLRenderer();
const scene = new Scene();
const camera = new PerspectiveCamera();

// 中间会有各种需要在场景中渲染出来的 3D 物体
// ......

renderer.render(scene, camera);
```

<!--more-->

上面的代码片段其实非常容易理解，创建一个渲染器 renderer，用这个渲染器去渲染场景 Scene 和相机 Camera 即可。在任何一个 3D 场景中，Camera 代表的其实就是人的眼睛。那么，Scene 代表的就是人的眼睛看到的物体。

Scene 继承自 Object3D，Scene 自身的属性和方法不多。

## 属性

1. background。背景，简单理解就是设置这个场景的背景，可以设置成颜色，或者纹理 Texture 等，默认为 null，此时渲染出来的场景会有一个黑色背景。
2. environment。环境，这个属性不是很好理解，它的类型必须是纹理，一旦设置了之后，场景中的物体就会默认使用这个纹理进行渲染，默认也是 null。
3. fog。雾，在一个场景中，有雾和没有雾，对人眼来说可见度是不同，也就是雾会影响到物体的颜色。默认为 null。
4. isScene。这是一个只读的属性，表明当前的这个 object 的类型是 Scene。显然这是基于继承而言的，当有多个类继承自 Object3D ，那就需要有一种方法来区分不同的子类实例的类型。
5. overrideMaterial。如果设置这个属性的话，场景中的物体都会使用这种材质进行渲染。

## 方法

1. toJSON。很显然，这个方法是用来序列化的，便于传输。

作为一个场景对象，Scene 提供的是渲染场景中的物体时的一些全局设定。那么场景作为一个 3D 对象本身，也具有一些属性和方法，这里仅做简要回顾。

## Object3D

一个场景中一般都会存在一个以上的物体，这些物体通过不同的方式组合在一起形成了一个场景，这种一对多的关系，就是通过 `children` 这个属性来表达的。当多个物体通过 `children` 这一属性关联起来之后，就形成了一个 Scene Graph 场景图。

有了 `children` 这个属性之后，必然就需要有 `add` 和 `remove` 方法来操作 `children` 中的对象。同时，与 `children` 相对的是 `parent` 属性。

当一个场景中有了多个物体，那么就需要控制哪些物体显示，哪些物体不显示在当前的场景中。因为通过不同的角度去观察同一个场景，可能存在有的物体在一个角度被遮挡无法显示，在另一个角度却能显示出来的情况。这种用到了 `layer` 属性，当一个物体与当前相机共享一个 layer 的时候，这个物体才会被渲染出来。

渲染物体时必须要知道它的位置，所以需要有 `position` 属性。而位置是一个相对的概念，在 threejs 里有两个重要的参照物，一个是全局参照物，一个是本地参照物。全局参照物用来对物体进行全局定位，这个比较容易理解。而本地参照物则是针对 `children` 来说的。

举个例子，如果想在场景中渲染一个汽车，那么汽车这个物体必然是由多个更小的物体组合而成，比如 4 个轮子。要在场景中绘制这 4 个轮子，既可以相对全局参照物，即使用全局坐标系来定位轮子，也可以用车身作为参照物。在大多数场景下，用车身作为轮子的参照物其实更有意义。因为大多数时候，当车身的位置发生变化的时候，车轮的位置是同步发生变化的，也就是说，车轮在这个时候相对车身其实是固定的。

当我们从不同的角度观察场景中的物体，看到的必然是不同的结果。站在物体本身的角度来说，就可以说是物体发生了*位移*、*变形*、*旋转*等变换。而这些变换，要么是基于矩阵 Matrix 进行的计算，要么是基于弧度进行的计算。因此，Object3D 上也有响应的属性来表达这些变化。

除了这些属性之外，Object3D 上也会有不同的方法，用户执行类似的变化操作，包括 rotate, translate。

这里并没有涵盖所有的属性和方法，因为有很多属性和方法与 threejs 中的其他概念有关联，在不理解这些概念之前，不太容易理解这些属性和方法存在的意义是什么。
